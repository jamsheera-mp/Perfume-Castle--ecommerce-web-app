<%- include('../partials/user/header.ejs') %>

<style>
/* Base styles */
.main {
    overflow-x: hidden;
}

/* Slider Section */
.home-slider {
    padding-top: 2rem;
	margin-bottom:3rem;
}

.single-hero-slider {
    padding: 2rem 0;
}

.hero-slider-content-2 {
    padding: 1rem;
}

.hero-slider-content-2 h4 {
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
}

.hero-slider-content-2 h2 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.hero-slider-content-2 h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

.single-slider-img {
    position: relative;
    overflow: hidden;
    height: 400px;
    margin: 1rem 0;
}

.single-slider-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.single-slider-img::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, white 0%, transparent 20%, transparent 80%, white 100%),
                linear-gradient(to right, white 0%, transparent 10%);
    z-index: 1;
    pointer-events: none;
}

/* product Grid Section */
.section-paddding{
	padding:3rem 0;
}

/* Product Grid */
.product-grid-4 {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin: 0;
    padding: 1rem;
}

.product-cart-wrap {
    display: flex;
    flex-direction: column;
    background: #fff;
    border: 1px solid #eee;
    border-radius: 8px;
    transition: box-shadow 0.3s ease;
    height: 100%;
	margin-bottom:1rem;
}

.product-cart-wrap:hover {
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.product-img-action-wrap {
    position: relative;
    padding-top: 100%;
    overflow: hidden;
}

.product-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.product-img img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 0.5rem;
}

.wishlist-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
    background: transparent;
    border: none;
    padding: 5px;
}

.product-content-wrap {
    display: flex;
    flex-direction: column;
    padding: 1rem;
    flex-grow: 1;
}

.product-category {
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.product-content-wrap h2 {
    font-size: 0.95rem;
    margin: 0 0 0.5rem 0;
    line-height: 1.4;
    flex-grow: 1;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.price-section {
    margin: 0.5rem 0;
}

.original-price {
    color: #999;
    font-size: 0.9rem;
    margin-right: 0.5rem;
    text-decoration: line-through;
}

.final-price {
    color: #088178;
    font-size: 1rem;
    font-weight: 600;
}

.stock-info {
    font-size: 0.8rem;
    margin: 0.5rem 0;
    color: #666;
}

.button-container {
    margin-top: auto;
    padding-top: 0.5rem;
}

.btn-brand {
    width: 100%;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    background: #088178;
    color: white;
    border: none;
    border-radius: 4px;
    transition: background 0.3s ease;
}

.btn-brand:hover {
    background: #066661;
}

/* Banner Section */
.banner-img {
    position: relative;
    overflow: hidden;
    border-radius: 10px;
    margin-bottom: 1rem;
}

.banner-text {
    position: absolute;
    top: 50%;
    left: 1rem;
    transform: translateY(-50%);
    color: #fff;
    z-index: 2;
}

.banner-img img {
    width: 100%;
    height: auto;
    transition: transform 0.3s ease;
}

.banner-img:hover img {
    transform: scale(1.05);
}

/* Responsive Media Queries */
@media (max-width: 1200px) {
    .product-grid-4 {
        grid-template-columns: repeat(3, 1fr);
    }
	.section-padding{
		padding: 2.5rem 0;
	}
}

@media (max-width: 992px) {
    .product-grid-4 {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
	.home-slider{
		margin-bottom: 2rem;
	}
	.section-padding{
		padding: 2rem 0;
	}
}

@media (max-width: 768px) {
	.home-slider{
		margin-bottom: 1.5rem;
	}
    .hero-slider-content-2 h4 {
        font-size: 1rem;
    }
    
    .hero-slider-content-2 h2 {
        font-size: 1.5rem;
    }
    
    .hero-slider-content-2 h1 {
        font-size: 2rem;
    }
    .single-hero-slider{
		padding: 1rem 0;
	}
	  /* Adjust slider content for better mobile display */
	  .hero-slider-content-2 {
        padding: 0.75rem;
        margin-bottom: 1rem;
    }
    
    .single-slider-img {
        height: 300px;
		margin:0;
    }
	.product-grid-4{
		padding:0.75rem;
	}
    .product-content-wrap {
        padding: 0.75rem;
    }
	.section-padding{
		padding: 1.5rem 0;
	}
}

@media (max-width: 576px) {
	.home-slider {
        margin-bottom: 1rem;
        padding-top: 1rem;
    }
    .product-grid-4 {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        padding: 0.5rem;
    }
	.section-padding {
        padding: 1rem 0;
    }

    .hero-slider-content-2 h4 {
        font-size: 0.9rem;
    }
    
    .hero-slider-content-2 h2 {
        font-size: 1.2rem;
    }
    
    .hero-slider-content-2 h1 {
        font-size: 1.5rem;
    }
    
    .single-slider-img {
        height: 250px;
    }

    .product-content-wrap {
        padding: 0.5rem;
    }

    .product-content-wrap h2 {
        font-size: 0.85rem;
    }

    .final-price {
        font-size: 0.9rem;
    }

    .btn-brand {
        padding: 0.4rem 0.75rem;
        font-size: 0.85rem;
    }
}

@media (max-width: 375px) {
    .product-grid-4 {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

</style>


	<!-----------------------------------------------main slider section starts  -------------------------------------------------------->
	<main class="main">
		<section class="home-slider position-relative">
			<div class="hero-slider-1 dot-style-1 dot-style-1-position-1">
				<div class="single-hero-slider single-animation-wrap">
					<div class="container">
						<div class="row align-items-center slider-animated-1">
							<div class="col-12 col-md-6 col-lg-5 order-2 order-md-1">
								<div class="hero-slider-content-2">
									<h4 class="animated">Exclusive Trade-In Offer</h4>
									<h2 class="animated fw-900">Luxurious Fragrances</h2>
									<h1 class="animated fw-900 text-brand">For Every Occasion</h1>
									<p class="animated">Get up to 50% off on selected perfumes</p>
									<a class="animated btn btn-brush btn-brush-3" href="/product"> Shop Now
									</a>
								</div>
							</div>
							<div class="col-12 col-md-6 col-lg-7 order-1 order-md-2">
								<div class="single-slider-img single-slider-img-1">
									<img class="animated slider-1-1" src="/uploads/slider-images/bottle-with-flower.jpg"
										alt="" style="width: 100%; height: 100%; object-fit: contain;">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="single-hero-slider single-animation-wrap">
					<div class="container">
						<div class="row align-items-center slider-animated-1">
							<div class="col-12 col-md-6 col-lg-5 order-2 order-md-1">
								<div class="hero-slider-content-2">
									<h4 class="animated">Special Promotions</h4>
									<h2 class="animated fw-900">Trending Perfumes</h2>
									<h1 class="animated fw-900 text-7">For Him & Her</h1>
									<p class="animated">Discover timeless scents at great prices</p>
									<a class="animated btn btn-brush btn-brush-2" href="/product"> Discover
										Now </a>
								</div>
							</div>
							<div class="col-12 col-md-6 col-lg-7 order-1 order-md-2">
								<div class="single-slider-img single-slider-img-1">
									<img class="animated slider-1-2 " src="/uploads/slider-images/pic4.jpg" alt=""
										style="width: 100%; height: 100%; object-fit: contain;">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="single-hero-slider single-animation-wrap">
					<div class="container">
						<div class="row align-items-center slider-animated-1">
							<div class="col-12 col-md-6 col-lg-5 order-2 order-md-1">
								<div class="hero-slider-content-2">
									<h4 class="animated">New Arrivals</h4>
									<h2 class="animated fw-900">Captivating Scents</h2>
									<h1 class="animated fw-900 text-8">From Top Brands</h1>
									<p class="animated">Shop the latest perfumes and colognes</p>
									<a class="animated btn btn-brush btn-brush-1" href="/product"> Shop Now
									</a>
								</div>
							</div>
							<div class="col-12 col-md-6 col-lg-7 order-1 order-md-2">
								<div class="single-slider-img single-slider-img-1">
									<img class="animated slider-1-3" src="/uploads/slider-images/pic7.jpg" alt=""
										style="width: 100%; height: 100%; object-fit: contain;">
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="slider-arrow hero-slider-1-arrow"></div>
		</section>

		<!-----------------------------------------------main slider section ends  -------------------------------------------------------->



		<!-- ---------------------------------------------------------Product Listing Section Starts ------------------------------------------------->
		<section class="product-tabs section-padding position-relative wow fadeIn animated">
			<!--<div class="bg-square"></div>-->
			<div class="container">
				<div class="tab-header" style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
					<a href="/product" class="view-more d-inline-flex align-items-center">View More<i
							class="fi-rs-angle-double-small-right"></i></a>
				</div>
				<!--End nav-tabs-->
				<!----------------------------------- All products Listings ---------------------------------------------------->
				<div class="tab-content wow fadeIn animated" id="myTabContent">
					<div class="tab-pane fade show active  position-relative" id="tab-one" role="tabpanel" aria-labelledby="tab-one">
						<div class="row product-grid-4 g-3">
							<% if(products && products.length> 0) { %>
								<% products.forEach(product=>{ %>
									<% if(product.productImage && product.productImage.length > 0) { %>
									<div >
										<div class="product-cart-wrap mb-30">
											<div class="product-img-action-wrap">
												<div class="product-img product-img-zoom" style="position: relative;">
													<a href="/product/<%= product._id %>">
														<img src="<%= product.productImage[0] %>"
															alt="<%= product.productName %>"
															style="width: 100%; height: auto;">
														<img class="hover-img"
														src= "<%= product.productImage[0]%>"
															alt="<%= product.productName %>"
															style="width: 100%; height: auto;">
													</a>

													<!------------ Wishlist button --------------->
													<button type="button"
														class="wishlist-btn <%= product.isInWishlist ? 'in-wishlist' : '' %>"
														onclick="toggleWishlist(event, '<%= product._id %>')"
														aria-label="Toggle Wishlist"
														style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; cursor: pointer; padding: 5px; z-index: 10;">
														<svg class="wishlist-icon-outline <%= product.isInWishlist ? 'd-none' : '' %>"
															xmlns="http://www.w3.org/2000/svg" width="24" height="24"
															viewBox="0 0 24 24" fill="none" stroke="#088178"
															stroke-width="2" stroke-linecap="round"
															stroke-linejoin="round">
															<path
																d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
															</path>
														</svg>
														<svg class="wishlist-icon-filled <%= product.isInWishlist ? '' : 'd-none' %>"
															xmlns="http://www.w3.org/2000/svg" width="24" height="24"
															viewBox="0 0 24 24" fill="#088178" stroke="#088178"
															stroke-width="2" stroke-linecap="round"
															stroke-linejoin="round">
															<path
																d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
															</path>
														</svg>
													</button>
													<!------------wishlist button ends------------>
												</div>
											</div>
											<div class="product-content-wrap" style="padding: 15px;">
												<div class="product-category">
													<a href="" style="color: #666; font-size: 14px;">
														<% product.Category %>
													</a>
												</div>
												<h2 class="text-center"
													style="margin: 10px 0; font-size: 16px; font-weight: 600;">
													<a href="" style="color: #333; text-decoration: none;">
														<%= product.productName %>
													</a>
												</h2>

												<div class="price-section">
													<div class="price-row text-center">
														<% if (product.hasOffer) { %>
															<span class="original-price "
																style="text-decoration: line-through;">₹<%=
																	product.basePrice.toFixed(2) %></span>
															<span class="final-price">₹<%= product.finalPrice.toFixed(2)
																	%></span>
															<% } else { %>
																<span class="final-price">₹<%=
																		product.basePrice.toFixed(2) %></span>
																<% } %>
													</div>

													<% if (product.hasOffer && product.offer) { %>
														<div class="offers-applied text-center">

															<span class="badge bg-success">
																<%= product.discountPercentage %>% off
															</span>


														</div>
														<% } %>
												</div>

												<div class="stock-info text-center">
													<% if (product.quantity> 0) { %>
														Stock left: <%= product.quantity %>
															<% } else { %>
																<span class="out-of-stock" style=" color:red;">Out of
																	stock</span>
																<% } %>
												</div>
												<!-- Add to Cart section  -->
												<div class="button-container text-center">
													<form id="addToCartForm" data-product-id="<%= product._id %>"
														data-quantity="1">
														<% if (product.isInCart) { %>
															<a href="/cart"
																class="btn btn-sm font-sm rounded btn-brand">
																<i class="material-icons md-shopping_cart"></i>
																Go to Cart
															</a>
															<% } else { %>
																<button id="addToCartBtn" type="submit"
																	class="btn  font-sm rounded btn-brand addToCartBtn mt-2"
																	<%=product.quantity===0 ? 'disabled' : '' %>>
																	<i class="material-icons md-add_shopping_cart"></i>
																	Add to Cart
																</button>
																<% } %>
													</form>
												</div>

												<!-- add to cart ends-->
											</div>
										</div>
									</div>
									<% } %>
									<% }) %>
										<% } else { %>
											<div class="col-12">
												<p>No products available.</p>
											</div>
											<% } %>
						</div>
					</div>
				</div>
			</div><!--end container-->
			<!--End tab-content-->
			</div>
		</section>

		<!-- ---------------------------------------------------------Product Listing Section Ends ------------------------------------------------->
		
	</main>


	<!----------------------------add to cart-------------------------->
	<script>
		// Wait for the DOM to be fully loaded
		document.addEventListener('DOMContentLoaded', function () {
    const forms = document.querySelectorAll('form[id^="addToCartForm"]');

    forms.forEach(form => {
        form.addEventListener('submit', async function (event) {
            event.preventDefault();

            const productId = this.getAttribute('data-product-id');
            const quantity = parseInt(this.getAttribute('data-quantity'));

            if (!productId) {
                console.error('Product ID is missing');
                return;
            }

            try {
                const submitButton = this.querySelector('button[type="submit"]');
                if (submitButton) {
                    submitButton.disabled = true;
                }

                const response = await fetch('/addToCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        productId, 
                        quantity: quantity 
                    }),
                    redirect: 'follow'
                });

                // Handle redirects
                if (response.redirected || response.url.includes('/login')) {
                    window.location.href = response.url || '/login';
                    return;
                }

                const data = await response.json();

                if (data.redirect) {
                    window.location.href = data.redirect;
                    return;
                }

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to add to cart');
                }

                if (data.success) {
                    // Update cart icon
                    if (data.cart && typeof data.cart.cartItemCount !== 'undefined') {
                        updateCartIcon(data.cart.cartItemCount);
                    }

                    // Replace "Add to Cart" button with "Go to Cart" link
                    if (data.isInCart) {
                        const buttonContainer = this.querySelector('button');
                        if (buttonContainer) {
                            const goToCartLink = document.createElement('a');
                            goToCartLink.href = '/cart';
                            goToCartLink.className = 'btn btn-md font-md rounded btn-brand';
                            goToCartLink.innerHTML = '<i class="material-icons md-shopping_cart"></i> Go to Cart';
                            buttonContainer.replaceWith(goToCartLink);
                        }
                    }

                    // Show success message
                    const result = await Swal.fire({
                        icon: 'success',
                        title: 'Product added to cart',
                        text: 'Item successfully added to your cart!',
                        showCancelButton: true,
                        cancelButtonText: 'Continue Shopping',
                        confirmButtonText: 'View Cart'
                    });

                    if (result.isConfirmed) {
                        window.location.href = '/cart';
                    }
                }
            } catch (error) {
                console.error('Add to cart error:', error);
                
                if (error.message && error.message.includes('<!DOCTYPE html>')) {
                    const result = await Swal.fire({
                        icon: 'error',
                        title: 'Please Log In',
                        text: 'You need to be logged in to add items to your cart',
                        showCancelButton: true,
                        cancelButtonText: 'Stay Here',
                        confirmButtonText: 'Go to Login'
                    });

                    if (result.isConfirmed) {
                        window.location.href = '/login';
                    }
                } else {
                    await Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: error.message || 'Failed to add item to cart'
                    });
                }
            } finally {
                const submitButton = this.querySelector('button[type="submit"]');
                if (submitButton) {
                    submitButton.disabled = false;
                }
            }
        });
    });
});

function updateCartIcon(count) {
    const cartCountElement = document.getElementById('cart-count');
    if (cartCountElement) {
        cartCountElement.textContent = count;
        cartCountElement.classList.add('cart-update-animation');
        setTimeout(() => {
            cartCountElement.classList.remove('cart-update-animation');
        }, 300);
    }
}
	</script>
<!-----------------------------------add to wishlist------------------------------------->
	<script>
		function toggleWishlist(event, productId) {
			event.preventDefault();
			const button = event.currentTarget;
			const outlineIcon = button.querySelector('.wishlist-icon-outline');
			const filledIcon = button.querySelector('.wishlist-icon-filled');
			fetch(`/toggleWishlist/${productId}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
			})
				.then(response => response.json())
				.then(data => {
					if (data.redirect) {
						// If server indicates redirect is needed, redirect to login
						window.location.href = data.redirect;
						return;
					}
					if (data.success) {
						// Toggle visibility of icons
						outlineIcon.classList.toggle('d-none');
						filledIcon.classList.toggle('d-none');
						button.classList.toggle('in-wishlist');
						button.classList.add('animate');

						// Remove animation class after animation completes
						setTimeout(() => {
							button.classList.remove('animate');
						}, 300);

					
						// Update the wishlist count in header
						updateWishlistCount(data.wishlistCount);

						
					}
					
				})
				.catch(error => {
					console.error('Error:', error);
					Swal.fire({
						icon: 'error',
						title: 'Oops...',
						text: 'An error occurred while updating wishlist',
						confirmButtonText: 'OK'
					});
				});
			return false;
		}

		// function to update the wishlist count in header
		function updateWishlistCount(count) {
			const wishlistCountElement = document.getElementById('wishlist-count');
			if (wishlistCountElement) {
				wishlistCountElement.textContent = count;

				// Add animation to highlight the count change
				wishlistCountElement.classList.add('count-updated');
				setTimeout(() => {
					wishlistCountElement.classList.remove('count-updated');
				}, 300);
			}
		}
	</script>
	<!----------------------------add to cart end-------------------------->

	<%- include('../partials/user/footer.ejs') %>